<!DOCTYPE html>
<html>

<head>
<style>
body {
    background-color: #000;
    color: #fff;
    display: flex;
    flex-direction: column;
    margin: 0;
    font-family: Arial, sans-serif;
    text-align: center;
    overflow: hidden;
    height: 100vh; /* Ensures the body takes the full viewport height */
}
.gui-container {
    overflow: hidden; /* Change from auto to hidden */
    padding-top: 45px;
	padding-bottom: 20px;
    scrollbar-width: none; /* Firefox */
    -ms-overflow-style: none; /* IE and Edge */
    justify-content: center;
    display: flex;
    flex-direction: row;
    margin: -30px 0px 0px 0px; /* Margin for top, right, bottom, left */
    width: 100%;
    transition: transform 0.3s ease;
    zoom: 100%; /* Fixed zoom */
}

.gui-icon {
    flex: 0 0 auto;
    flex-direction: column;
    font-size: 18px;
    margin: 0px 8px 7px 8px;
    display: flex;
    opacity: 1;
    align-items: center;
    justify-content: top;
    cursor: pointer;
    position: relative;
    transform: scale(0.9);
    transition: transform 0.3s ease;
    zoom: 100%; /* Fixed zoom */
}


	
.gui-icon:hover {
        opacity: 0.8;
    }

.gui-icon.active {
    z-index: 1;
    margin: -15px 0px 0px 0px;
    transform: scale(1.1);
    opacity: 1;
    transform-origin: center;
    transition: transform 0.3s ease;
    animation: pulseOpacity 1.5s infinite linear;
    filter: drop-shadow(0 0 10px rgba(255, 255, 255, 0.7));
	zoom: 100%; /* Fixed zoom */
}

.gui-icon.active img {
    filter: drop-shadow(0 0 8px rgba(255, 255, 255, 0.6));
    animation: pulseOpacity 1.5s infinite linear;
}


.icon-label {
        display: flex;
		font-size: 18px;
		margin: 0; 
        align-items: center; 
        opacity: 1;
        transition: opacity 0.3s ease;
    }

.gui-icon.active .icon-label {
        visibility: visible;
		font-size: 20px;
        opacity: 1;
		animation: pulseOpacity 1.5s infinite linear;
    }

.gui-icon.active .sub-options {
        display: flex;
		animation: pulseOpacity 1.5s infinite linear;
    }
	
.icon-label-sub {
        visibility: hidden;
        font-size: 17px;
        opacity: 1;
        transition: opacity 0.3s ease;
    }
	
h3 {
        font-size: 15px;
        opacity: 0.9;
		margin: 0px;
    }

h4 {
        font-size: 12px;
        opacity: 0.9;
		margin: 0px;
    }

.gui-icon.active-sub .icon-label-sub {
        visibility: visible;
        font-size: 20px;
        opacity: 0.9;
        animation: pulseOpacity 1.5s infinite linear;
    }

@keyframes pulseOpacity {
        0% {
            text-shadow: 0 0 15px rgba(255, 255, 255, 0.2), 0 0 16px rgba(255, 255, 255, 0.2), 0 0 20px rgba(255, 255, 255, 0.2);
        }
        50% {
            text-shadow: 0 0 15px rgba(255, 255, 255, 0.7), 0 0 16px rgba(255, 255, 255, 0.7), 0 0 20px rgba(255, 255, 255, 0.7);
        }
        100% {
            text-shadow: 0 0 15px rgba(255, 255, 255, 0.2), 0 0 16px rgba(255, 255, 255, 0.2), 0 0 20px rgba(255, 255, 255, 0.2);
        }
    }
	
	.sub-option {
  display: flex;
  flex-direction: column;
  align-items: center;
  margin: 0px 15px 0px 15px;
    font-size: 14px;
    color: #fff;
    cursor: pointer;
    opacity: 1;
    transition: opacity 0.3s ease;
}

.sub-option-icon {
    margin: 0px 0px 0px 0px;
    cursor: pointer;
    transition: opacity 0.3s ease;
	display: flex;
    flex-direction: column;
}

.sub-option.active-option {
    opacity: 1;
	margin: -10px 0px 0px 0px; 
    transform: scale(1.2);
    transition: transform 0.3s ease;
    animation: pulseOpacity2 1.5s infinite linear;
    filter: drop-shadow(0 0 13px rgba(255, 255, 255, 0.7));
}

.sub-options-container {
    display: flex;
	margin: 0px;
    justify-content: center;
  }

  .sub-options {
    display: flex;
    flex-direction: row;
    justify-content: center;
  }

.sub-option:hover {
    opacity: 1;
}

.sort-option {
    display: flex;
	flex-direction: column;
	text-align: center;
	margin: 0px 15px 0px 15px;
    font-size: 8px;
    color: #fff;
    cursor: pointer;
    opacity: 0.6;
    transition: opacity 0.3s ease;
}

.sort-option-icon {
    margin: 0px 0px 0px 0px;
    cursor: pointer;
    transition: opacity 0.3s ease;
	display: flex;
    flex-direction: column;
}

.sort-option.active-option {
    opacity: 1;
	margin: -10px 0px 0px 0px; 
    transform: scale(1.2);
    transition: transform 0.3s ease;
    animation: pulseOpacity2 1.5s infinite linear;
    filter: drop-shadow(0 0 13px rgba(255, 255, 255, 0.7));
}

.sort-options-container {
    justify-content: right;
    left: 85%;
    transform: translateX(-20%);
}

.sort-option:hover {
    opacity: 0.7;
}

.container {
            text-align: center;
            justify-content: center;
            width: 56%;
            border-radius: 15px;
            border: 2px solid blue;
            margin-top: 10px;
            margin-bottom: 0px;
            box-shadow: 0px 0px 6px rgba(255, 255, 255, 0.5),
                        inset 3px 3px 10px rgba(0, 0, 0, 0.3);
        }
		
.wrapper {
    flex: 1; /* Ensures the wrapper takes the remaining height */
    display: flex;
    flex-direction: column;
    height: calc(100vh - 125px); /* Adjusting the height based on the viewport height minus the fixed elements */
    scrollbar-width: thin; /* Firefox */
    -ms-overflow-style: none; /* IE and Edge */
    overflow: auto;
}

.grid-container {
    display: grid;
    margin-top: 0px;
    grid-template-columns: repeat(auto-fill, 230px); /* Fixed column width */
    gap: 15px; /* Adjust gap between items */
    padding: 0px;
    flex: 1; /* Ensures grid-container takes the remaining height in the wrapper */
    overflow-y: auto;
    justify-content: start; /* Align items to the start (left) */
    align-content: start; /* Align items to the start (top) */
}


.grid-item {
    text-align: center;
    display: flex;
    flex-direction: column;
    align-items: center;
    margin-bottom: -10px;
	margin-top: 10px;
    cursor: pointer;
    max-width: 240px; /* Set a max-width for grid items */
    width: 100%; /* Make sure items are responsive */
}


.wrapper::-webkit-scrollbar {
    width: 5px; /* Width of the vertical scrollbar */
}

.wrapper::-webkit-scrollbar-track {
    background: transparent;
}

.wrapper::-webkit-scrollbar-thumb {
    background-color: rgba(255, 255, 255, 0.3);
    border-radius: 5px;
}


.grid-container::-webkit-scrollbar {
    width: 5px; /* Chrome, Safari, and Opera */
}

.grid-container::-webkit-scrollbar-track {
    background: transparent;
}

.grid-container::-webkit-scrollbar-thumb {
    background-color: rgba(255, 255, 255, 0.3);
    border-radius: 5px;
}
        

.uuid-name {
    font-size: 10px;
    margin-top: 0px;
    text-align: center;
    color: #FFFFFF;
	overflow: hidden;
	white-space: nowrap;
    text-overflow: clip;
    cursor: pointer;
	width: 240px;
}

.nice-name {
    font-size: 15px;
    margin-top: 0px;
	margin-bottom: 0px;
    padding: 0px 0px;
    text-align: center;
    color: #ffffff;
    cursor: pointer;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: clip;
    width: 225px; /* Adjust the width as needed */
    transition: all 0.5s ease; /* Adding a transition effect for smooth scrolling */
    animation: none;
}

@keyframes bounce {
    0% { transform: translateX(0); }
    50% { transform: translateX(-10px); } /* Adjust the movement here to move smoothly from right to left */
    100% { transform: translateX(0); } /* Adjust the movement here to move smoothly from left to right */
}

.nice-name:hover {
    animation: bounce 2s infinite linear;
    overflow: visible;
    white-space: nowrap;
	color: #FFFF00;
}

.folder-name {
    font-size: 9px ;
	margin-top: 0px;
	margin-bottom: 0px;
    padding-bottom: 18px;
	padding-left: 15px;
	padding-top: 3px;
	padding-right: 15px;
    text-align: center;
    color: #ffffff;
    cursor: pointer;
}

h3 {
  font-size: 14px;
		text-align: center;
		cursor: pointer;
		padding: 2px 0px 10px;
		margin-top: 0px; /* Adjust the spacing as needed */
}


.placeholder-image {
            border-radius: 15px;
			width: 90%;
        }
		
.placeholder-image:hover {
transition: transform 0.3s ease;
    animation: pulseOpacity3 1s infinite linear;
    filter: drop-shadow(0 0 18px rgba(255, 255, 255, 0.7));
	transform: scale(1.02);
    transition: transform 0.3s ease;
}

@keyframes pulseOpacity3 {
    0% {
        filter: drop-shadow(0 0 25px rgba(255, 255, 255, 1));
    }
    50% {
        filter: drop-shadow(0 0 15px rgba(255, 255, 255, 0.5));
    }
    100% {
        filter: drop-shadow(0 0 25px rgba(255, 255, 255, 1));
    }
}


@keyframes pulseOpacity2 {
    0% {
        filter: drop-shadow(0 0 15px rgba(255, 255, 255, 0.7));
    }
    50% {
        filter: drop-shadow(0 0 15px rgba(255, 255, 255, 0.1));
    }
    100% {
        filter: drop-shadow(0 0 15px rgba(255, 255, 255, 0.7));
    }
}

.notification {
    position: fixed;
    bottom: 10px;
    left: 50%;
    transform: translateX(-50%);
    background-color: #333;
    color: #fff;
    padding: 10px;
    border-radius: 5px;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
    z-index: 1000;
    opacity: 0;
    animation: fadeInOut 3s ease-in-out forwards;
}

@keyframes fadeInOut {
    0%, 100% { opacity: 0; }
    10%, 90% { opacity: 1; }
}

#postinstallPopup {
    position: fixed;
    align-items: center;
    top: 50%;
    margin: 3px;
    width: 480px;
	width: auto; /* Allow height to adjust based on content */
    height: auto; /* Allow height to adjust based on content */
    left: 49.6%;
    transform: translate(-50%, -50%) scale(0); /* Start scaled down to 0 */
    background: rgba(0, 0, 0, 0.96);
    padding: 4px;
    border-radius: 10px;
    color: white;
    border: 4px solid #fff;
    box-shadow: 0px 0px 6px rgba(0, 0, 255, 0.5), 
                inset 3px 3px 10px rgba(0, 0, 255, 0.3);
    animation: scaleUp 0.3s ease forwards; /* Apply the animation */
    overflow: auto; /* Add scrollbar if content overflows */
}

#postinstallPopup textarea::-webkit-scrollbar {
    width: 12px; /* Width of the vertical scrollbar */
    height: 12px; /* Height of the horizontal scrollbar */
}

#postinstallPopup textarea::-webkit-scrollbar-track {
    background: transparent;
}

#postinstallPopup textarea::-webkit-scrollbar-thumb {
    background-color: rgba(255, 255, 255, 0.3);
    border-radius: 20px;
}

#postinstallPopup textarea {
    scrollbar-width: thin; /* Firefox */
    scrollbar-color: rgba(255, 255, 255, 0.3) transparent; /* Firefox: thumb and track color */
}




@keyframes scaleUp {
    from {
        transform: translate(-50%, -50%) scale(0);
        opacity: 0;
    }
    to {
        transform: translate(-50%, -50%) scale(1);
        opacity: 1;
    }
}

@keyframes scaleDown {
    from {
        transform: translate(-50%, -50%) scale(1);
        opacity: 1;
    }
    to {
        transform: translate(-50%, -50%) scale(0);
        opacity: 0;
    }
}


#postinstallPopup button {
    padding: 3px 6px;
    font-size: 12px;
    background-color: #ffffff;
    color: #000;
    border: 1px solid #fff;
    border-radius: 5px;
    margin: 4px;
    cursor: pointer;
    box-shadow: 0px 0px 6px rgba(255, 255, 255, 0.5),
                inset 3px 3px 10px rgba(0, 0, 0, 0.3);
    transition: opacity 0.2s ease; /* Adding transition for smooth effect */
}

#postinstallPopup button:hover {
    opacity: 0.8;
}

/* Adding animation for click effect */
@keyframes clickFade {
    0% {
        opacity: 0.2;
    }
    100% {
        opacity: 0.2;
    }
}

#postinstallPopup button:active {
    animation: clickFade 0.3s ease forwards; /* Animation on button click */
}


#postinstallPopup textarea {
    height: 233px;
	min-height: 38px;
	max-height:590px;
	width: 580px;
	min-width: 460px;
	max-width: 95%;
	font-size: 12px;
    margin: 3px 0;
    padding: 2px;
	webkit-font-smoothing: subpixel-antialiased;
	padding-left: 6px;
    border-radius: 5px;
    border: 2px solid #fff;
    background-color: transparent;
    color: white;
	white-space: nowrap;
}

a {
        text-decoration: none;
        color: inherit;
		font-size: 12px;
    }
	
.downloadbutton {
			padding: 4px;
			font-size: 12px;
			height: 15px;
			margin: 4px;
			background-color: #ffffff;
			color: #000;
			border: 1px solid #000;
			border-radius: 5px;
			justify-content: center;
			cursor: pointer;
        }
		

#sqlOutput {
    height: 26px;
	font-size: 13px;
	max-width: 450px;
	min-width: 450px;
	justify-content: center;
    padding: 4px;
    border-radius: 5px;
    border: 2px solid #fff;
    background-color: transparent;
    color: white;
	overflow: auto;
}

#sqlOutput::-webkit-scrollbar {
    width: 7px; /* Width of the vertical scrollbar */
    height: 7px; /* Height of the horizontal scrollbar */
}

#sqlOutput::-webkit-scrollbar-track {
    background: transparent;
}

#sqlOutput::-webkit-scrollbar-thumb {
    background-color: rgba(255, 255, 255, 0.3);
    border-radius: 20px;
}

#sqlOutput {
    scrollbar-width: thin; /* Firefox */
    scrollbar-color: rgba(255, 255, 255, 0.3) transparent; /* Firefox: thumb and track color */
}

#sqlOutputContainer {
    display: flex;
    justify-content: center;
    width: 100%;
}

.button-group {
    display: flex;
    justify-content: center;
}

.button-group button,
.button-group a {
    margin: 4px;
	padding: 4px;
}


.go-button {	
border-radius: 8px;
	margin-bottom: 30px;
	margin-left: 15px;
	margin-top: 30px;
    width: 60px;
    height: 40px;
}

.go-button:hover {
    opacity: 0.7;
}

.button-row {
    margin-bottom: 5px;
	margin-top: 5px;
}

.low-profile-button {
    height: 0px;
	padding-bottom: 0px;
	padding-top: 0px;
    background-color: #333;
    color: #fff;
    border: none;
    border-radius: 3px;
    font-size: 0px;
    cursor: pointer;
}

.itemtypecounts{
    font-size: 13px;
	margin-top: -4px;
}

#keywordInput {
	width: 500px;
    padding: 8px;
    border: none;
	font-size: 15px;
    border-radius: 5px;
    background-color: #333;
    color: #fff;
    margin-top: 30px;
	margin-bottom: 30px;
}

#keywordInput::placeholder {
    color: #aaa;
}

#keywordInput:focus {
    outline: none;
}

#searchButton {
	width: 20px;
	height: 18px;
    /* Adjusted padding to match the input box */
    border: none;
    border-radius: 5px;
    background-color: #4CAF50;
    color: #fff;
    cursor: pointer;
}

#searchButton:hover {
    background-color: #45a049;
}

#premium {
    /* Your default styles for the premium textarea */
    border: 2px solid #fff; /* Example default border */
    background-color: transparent;
    color: white;
    /* Other styles... */
}

#premium:focus {
    /* Override focus styles to maintain the appearance */
    border: 2px solid #fff; /* Keep the border consistent */
    outline: none; /* Remove default focus outline */
}

#premium::-webkit-resizer {
    background-color: #FFF; /* Color of the resizer */
    border: 2px solid #FFF; /* Border for the resizer */
}

.sorting-buttons {
    padding: 1px 1px;
    font-size: 5px;
    margin: 1px;
    color: #333;
    cursor: pointer;
    transition: background-color 0.3s ease;
}

#sqlsortbutton {
    padding: 2px 4px; /* Reduced padding */
    font-size: 10px; /* Smaller font size */
    margin: 1px; /* Reduced margin */
    background-color: #f2f2f2;
    color: #333;
    border: 1px solid #ccc; /* Optional: finer border */
    border-radius: 3px; /* Rounded corners */
    cursor: pointer;
    transition: background-color 0.3s ease;
}

.sqlsortbutton:hover {
    background-color: #ddd;
}

.context-menu {
    display: none;
	font-size: 15px; 
    position: absolute;
    background-color: #333;
    border: 1px solid #555;
    border-radius: 5px;
    z-index: 1000;
    width: 180px;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.5);
}

.context-menu ul {
    list-style: none;
    padding: 5px;
    margin: 0;
}

.context-menu ul li {
    padding: 4px 6px;
    cursor: pointer;
    color: #fff;
    transition: background-color 0.3s ease;
}

.context-menu ul li:hover {
    background-color: #444;
}


</style>
</head>

<body>
	<a href="pshome_index.html">
	  </a>
   <div class="gui-container" id="gui-container">
        <div class="gui-icon" onclick="loadLastActiveSubOption(0, 'categories/Clothing_Male_Outfit.xml')">
            <img src="ICON/MALE6.PNG">
			<div style="margin-top: 0px;" class="icon-label">Male</div>
        </div>
        <div class="gui-icon" onclick="loadLastActiveSubOption(1, 'categories/Clothing_Female_Outfit.xml')">
            <img src="ICON/FEMALE6.PNG">
			 <div style="margin-top: 0px;" class="icon-label">Female</div>
        </div>
        <div class="gui-icon" onclick="loadLastActiveSubOption(2, 'categories/Furniture_Appliance.xml')">
            <img src="ICON/FURNITUR.PNG">
			 <div style="margin-top: 0px;" class="icon-label">Furniture</div>
        </div>
		<div class="gui-icon" onclick="loadLastActiveSubOption(3, 'categories/Portable_Companion.xml')">
            <img src="ICON/PORTABLE.PNG">
			<div style="margin-top: 0px;" class="icon-label">Portables</div>
        </div>
		<div class="gui-icon" onclick="loadLastActiveSubOption(4, 'categories/Scene_Entitlements.xml')">
            <img src="ICON/SPACE2.PNG">
			<div style="margin-top: 0px;" class="icon-label">Spaces</div>
        </div>
		<div class="gui-icon" onclick="loadLastActiveSubOption(5, 'categories/Consumable.xml')">
            <img src="ICON/REWARDS3.PNG">
			<div style="margin-top: 0px;" class="icon-label">Other</div>
        </div>
		<div class="gui-icon" onclick="loadLastActiveSubOption(6, 'categories/Minigame_Arcade_Machine.xml')" style="display: none;">
			<img src="ICON/MINIGAMES2.PNG">
			<div style="margin-top: 0px;" class="icon-label">Minigames</div>
		</div>
		<div class="gui-icon" onclick="loadLastActiveSubOption(7, 'categories/Core.xml')" style="display: none;">
			<img src="ICON/SYSTEM.PNG">
			<div style="margin-top: 0px;" class="icon-label">System</div>
		</div>
		<div class="gui-icon" onclick="loadLastActiveSubOption(8, 'categories/Male_Bundle.xml')" style="display: none;">
			<img src="ICON/BUNDLES2.PNG">
			<div style="margin-top: 0px;" class="icon-label">Bundles</div>
		</div>

		<div class="gui-icon" onclick="loadLastActiveSubOption(9, 'categories/Male_Bundle.xml')">
            <img src="ICON/TOOLS.PNG">
			<div style="margin-top: 0px;" class="icon-label">User Lists</div>
        </div>
		<div class="gui-icon active">
            <img src="ICON/SEARCH.PNG">
			<div style="margin-top: 0px;" class="icon-label">Search</div>
        </div>
    </div>
	<div class="sub-options-container">
    <div class="sub-options" id="sub-options-0">
		<div class="sub-option" onclick="loadFolder('categories/Clothing_Male_Outfit.xml')"><span class="sub-option-icon"><img src="ICON/OUTFITS.PNG" alt="Outfits Icon"></span>Outfits</div>
        <div class="sub-option" onclick="loadFolder('categories/Clothing_Male_Hat.xml')"><span class="sub-option-icon"><img src="ICON/MALE_HATS.PNG" alt="Hat Icon"></span>Hats</div>
        <div class="sub-option" onclick="loadFolder('categories/Clothing_Male_Hair.xml')"><span class="sub-option-icon"><img src="ICON/MALE_HAIR.PNG" alt="Hair Icon"></span>Hair</div>
        <div class="sub-option" onclick="loadFolder('categories/Clothing_Male_Torso.xml')"><span class="sub-option-icon"><img src="ICON/TORSO.PNG" alt="Torso Icon"></span>Torso</div>
        <div class="sub-option" onclick="loadFolder('categories/Clothing_Male_Hands.xml')"><span class="sub-option-icon"><img src="ICON/HANDS.PNG" alt="Hands Icon"></span>Hands</div>
        <div class="sub-option" onclick="loadFolder('categories/Clothing_Male_Legs.xml')"><span class="sub-option-icon"><img src="ICON/LEGS.PNG" alt="Legs Icon"></span>Legs</div>
        <div class="sub-option" onclick="loadFolder('categories/Clothing_Male_Feet.xml')"><span class="sub-option-icon"><img src="ICON/FEET.PNG" alt="Feet Icon"></span>Feet</div>
        <div class="sub-option" onclick="loadFolder('categories/Clothing_Male_Jewellery.xml')"><span class="sub-option-icon"><img src="ICON/JEWELLERY.PNG" alt="Jewellery Icon"></span>Jewellery</div>
        <div class="sub-option" onclick="loadFolder('categories/Clothing_Male_Glasses.xml')"><span class="sub-option-icon"><img src="ICON/GLASSES.PNG" alt="Glasses Icon"></span>Glasses</div>
        <div class="sub-option" onclick="loadFolder('categories/Clothing_Male_HeadPhones.xml')"><span class="sub-option-icon"><img src="ICON/HEADPHONES.PNG" alt="Headphones Icon"></span>Headphones</div>
        <div class="sub-option" onclick="loadFolder('categories/Clothing_Male_FacialHair.xml')"><span class="sub-option-icon"><img src="ICON/FACIAL_HAIR.PNG" alt="Facial Hair Icon"></span>FacialHair</div>
    </div>
</div>
<div class="sub-options-container">
    <div class="sub-options" id="sub-options-1">
        <div class="sub-option" onclick="loadFolder('categories/Clothing_Female_Outfit.xml')"><span class="sub-option-icon"><img src="ICON/OUTFITS.PNG" alt="Outfits Icon"></span>Outfits</div>
        <div class="sub-option" onclick="loadFolder('categories/Clothing_Female_Hat.xml')"><span class="sub-option-icon"><img src="ICON/FEMALE_HATS.PNG" alt="Hat Icon"></span>Hats</div>
        <div class="sub-option" onclick="loadFolder('categories/Clothing_Female_Hair.xml')"><span class="sub-option-icon"><img src="ICON/FEMALE_HAIR.PNG" alt="Hair Icon"></span>Hair</div>
        <div class="sub-option" onclick="loadFolder('categories/Clothing_Female_Torso.xml')"><span class="sub-option-icon"><img src="ICON/TORSO.PNG" alt="Torso Icon"></span>Torso</div>
        <div class="sub-option" onclick="loadFolder('categories/Clothing_Female_Hands.xml')"><span class="sub-option-icon"><img src="ICON/HANDS.PNG" alt="Hands Icon"></span>Hands</div>
        <div class="sub-option" onclick="loadFolder('categories/Clothing_Female_Legs.xml')"><span class="sub-option-icon"><img src="ICON/FEMALE_LEGS.PNG" alt="Legs Icon"></span>Legs</div>
        <div class="sub-option" onclick="loadFolder('categories/Clothing_Female_Feet.xml')"><span class="sub-option-icon"><img src="ICON/FEMALE_FEET.PNG" alt="Feet Icon"></span>Feet</div>
        <div class="sub-option" onclick="loadFolder('categories/Clothing_Female_Jewellery.xml')"><span class="sub-option-icon"><img src="ICON/JEWELLERY.PNG" alt="Jewellery Icon"></span>Jewellery</div>
        <div class="sub-option" onclick="loadFolder('categories/Clothing_Female_Glasses.xml')"><span class="sub-option-icon"><img src="ICON/GLASSES.PNG" alt="Glasses Icon"></span>Glasses</div>
        <div class="sub-option" onclick="loadFolder('categories/Clothing_Female_HeadPhones.xml')"><span class="sub-option-icon"><img src="ICON/HEADPHONES.PNG" alt="Headphones Icon"></span>Headphones</div>
    </div>
</div>
<div class="sub-options-container">
    <div class="sub-options" id="sub-options-2">
        <div class="sub-option" onclick="loadFolder('categories/Furniture_Appliance.xml')"><span class="sub-option-icon"><img src="ICON/APPLIANCES.PNG" alt="Appliance Icon"></span>Appliances</div>
        <div class="sub-option" onclick="loadFolder('categories/Furniture_Chair.xml')"><span class="sub-option-icon"><img src="ICON/CHAIRS.PNG" alt="Chair Icon"></span>Chairs</div>
        <div class="sub-option" onclick="loadFolder('categories/Furniture_Cube.xml')"><span class="sub-option-icon"><img src="ICON/CUBE.PNG" alt="Cubes Icon"></span>Cubes</div>
        <div class="sub-option" onclick="loadFolder('categories/Furniture_Flooring.xml')"><span class="sub-option-icon"><img src="ICON/FLOORING.PNG" alt="Flooring Icon"></span>Flooring</div>
        <div class="sub-option" onclick="loadFolder('categories/Furniture_Footstool.xml')"><span class="sub-option-icon"><img src="ICON/FOOTSTOOLS.PNG" alt="Footstool Icon"></span>Footstools</div>
        <div class="sub-option" onclick="loadFolder('categories/Furniture_Frame.xml')"><span class="sub-option-icon"><img src="ICON/FRAMES.PNG" alt="Frame Icon"></span>Frames</div>
        <div class="sub-option" onclick="loadFolder('categories/Furniture_Light.xml')"><span class="sub-option-icon"><img src="ICON/LIGHTS.PNG" alt="Light Icon"></span>Lights</div>
        <div class="sub-option" onclick="loadFolder('categories/Furniture_Ornament.xml')"><span class="sub-option-icon"><img src="ICON/VASE.PNG" alt="Ornament Icon"></span>Ornaments</div>
        <div class="sub-option" onclick="loadFolder('categories/Furniture_Sofa.xml')"><span class="sub-option-icon"><img src="ICON/SOFAS.PNG" alt="Sofa Icon"></span>Sofas</div>
        <div class="sub-option" onclick="loadFolder('categories/Furniture_Table.xml')"><span class="sub-option-icon"><img src="ICON/TABLES.PNG" alt="Table Icon"></span>Tables</div>
        <div class="sub-option" onclick="loadFolder('categories/Furniture_Storage.xml')"><span class="sub-option-icon"><img src="ICON/STORAGE.PNG" alt="Storage Icon"></span>Storage</div>
    </div>
</div>
<div class="sub-options-container">
    <div class="sub-options" id="sub-options-3">
        <div class="sub-option" onclick="loadFolder('categories/Portable_Companion.xml')"><span class="sub-option-icon"><img src="ICON/COMPANIONS.PNG" alt="Targetable Icon"></span>Companions</div>
        <div class="sub-option" onclick="loadFolder('categories/Portable_Locomotion.xml')"><span class="sub-option-icon"><img src="ICON/LOCOMOTION2.PNG" alt="Minigames Icon"></span>Locomotions</div>
		<div class="sub-option" onclick="loadFolder('categories/Interactions_Animations.xml')"><span class="sub-option-icon"><img src="ICON/ANIMATIONS2.PNG" alt="Animations Icon"></span>Animations</div>
        <div class="sub-option" onclick="loadFolder('categories/Interaction_Dances.xml')"><span class="sub-option-icon"><img src="ICON/DANCES.PNG" alt="Dances Icon"></span>Dances</div>
        <div class="sub-option" onclick="loadFolder('categories/Interactions_Group.xml')"><span class="sub-option-icon"><img src="ICON/ANIMATION_GROUP.PNG" alt="Group Icon"></span>Group</div>
		<div class="sub-option" onclick="loadFolder('categories/Interactions_Soundpacks.xml')"><span class="sub-option-icon"><img src="ICON/SOUNDPACK.PNG" alt="Soundpacks Icon"></span>Soundpacks</div>
    </div>
</div>
<div class="sub-options-container">
    <div class="sub-options" id="sub-options-4">
		<div class="sub-option" onclick="loadFolder('categories/Scene_Entitlements.xml')"><span class="sub-option-icon"><img src="ICON/ENTITLEMENTS.PNG" alt="Entitlements Icon"></span>Entitlements</div>
		<div class="sub-option" onclick="loadFolder('categories/Apt_Addon.xml')"><span class="sub-option-icon"><img src="ICON/APTADDONS2.PNG" alt="Resources Icon"></span>Add-ons</div>
    </div>
</div>
<div class="sub-options-container">
    <div class="sub-options" id="sub-options-5">
		<div class="sub-option" onclick="loadFolder('categories/Consumable.xml')"><span class="sub-option-icon"><img src="ICON/COINS.PNG" alt="Consumables Icon"></span>Consumables</div>
		<div class="sub-option" onclick="loadFolder('categories/Sticker.xml')"><span class="sub-option-icon"><img src="ICON/STICKERS.PNG" alt="Stickers Icon"></span>Stickers</div>
		<div class="sub-option" onclick="loadFolder('categories/Weapons.xml')"><span class="sub-option-icon"><img src="ICON/WEAPONS.PNG" alt="Embedded Icon"></span>Weapons</div>
		<div class="sub-option" onclick="loadFolder('categories/Aquarium.xml')"><span class="sub-option-icon"><img src="ICON/AQUARIUM.PNG" alt="Embedded Icon"></span>Fishy</div>
		<div class="sub-option" onclick="loadFolder('categories/Sodium.xml')"><span class="sub-option-icon"><img src="ICON/SODIUM.PNG" alt="Embedded Icon"></span>Sci-Fi</div>
        <div class="sub-option" style="display: none;" onclick="loadFolder('categories/Unknown.xml')"><span class="sub-option-icon"><img src="ICON/PLACEHOLDER.PNG" alt="Unknown Icon"></span>Unsorted</div>
    </div>
</div>
<div class="sub-options-container">
    <div class="sub-options" id="sub-options-6">
		<div class="sub-option" onclick="loadFolder('categories/Minigame_Arcade_Machine.xml')"><span class="sub-option-icon"><img src="ICON/ARCADE.PNG" alt="Arcade Icon"></span>Arcade</div>
		<div class="sub-option" onclick="loadFolder('categories/Minigame.xml')"><span class="sub-option-icon"><img src="ICON/MINIGAMES.PNG" alt="Resources Icon"></span>Minigames</div>
		<div class="sub-option" onclick="loadFolder('categories/Minigame_Targetable.xml')"><span class="sub-option-icon"><img src="ICON/TARGETABLE.PNG" alt="Arcade Icon"></span>Targetable</div>
		<div class="sub-option" onclick="loadFolder('categories/Embedded_Objects.xml')"><span class="sub-option-icon"><img src="ICON/EMBEDDED.PNG" alt="Embedded Icon"></span>Embedded</div>
    </div>
</div>
<div class="sub-options-container">
    <div class="sub-options" id="sub-options-7">
        <div class="sub-option" onclick="loadFolder('categories/Core.xml')"><span class="sub-option-icon"><img src="ICON/CORE.PNG" alt="Resources Icon"></span>Core</div>
		<div class="sub-option" onclick="loadFolder('categories/Resource_Packs.xml')"><span class="sub-option-icon"><img src="ICON/RESOURCEPACK.PNG" alt="Resources Icon"></span>Resources</div>
		<div class="sub-option" onclick="loadFolder('categories/Worldmap_Objects.xml')"><span class="sub-option-icon"><img src="ICON/WORLDMAP.PNG" alt="Worldmap Icon"></span>Worldmap</div>
		<div class="sub-option" onclick="loadFolder('categories/Game_Launching_Object.xml')"><span class="sub-option-icon"><img src="ICON/GAMELAUNCHING.PNG" alt="Launching Icon"></span>Launching</div>
    </div>
</div>
<div class="sub-options-container">
    <div class="sub-options" id="sub-options-8">
		<div class="sub-option" onclick="loadFolder('categories/Male_Bundle.xml')"><span class="sub-option-icon"><img src="ICON/MALE_BUNDLE.PNG" alt="Part 3 Icon"></span>Male</div>
		<div class="sub-option" onclick="loadFolder('categories/Female_Bundle.xml')"><span class="sub-option-icon"><img src="ICON/FEMALE_BUNDLE.PNG" alt="Part 3 Icon"></span>Female</div>
		<div class="sub-option" onclick="loadFolder('categories/Clothing_Bundle.xml')"><span class="sub-option-icon"><img src="ICON/CLOTHING_BUNDLE.PNG" alt="Part 4 Icon"></span>Clothing</div>
        <div class="sub-option" onclick="loadFolder('categories/Furniture_Bundle.xml')"><span class="sub-option-icon"><img src="ICON/FURNITURE_BUNDLE.PNG" alt="Part 4 Icon"></span>Furniture</div>
		<div class="sub-option" onclick="loadFolder('categories/Animation_Bundle.xml')"><span class="sub-option-icon"><img src="ICON/DANCES.PNG" alt="Part 1 Icon"></span>Animations</div>
        <div class="sub-option" onclick="loadFolder('categories/Locomotion_Bundle.xml')"><span class="sub-option-icon"><img src="ICON/LOCOMOTION2.PNG" alt="Part 2 Icon"></span>Locomotions</div>
		<div class="sub-option" onclick="loadFolder('categories/Companion_Bundle.xml')"><span class="sub-option-icon"><img src="ICON/COMPANIONS.PNG" alt="Part 4 Icon"></span>Companions</div>
		<div class="sub-option" onclick="loadFolder('categories/Apt_Bundle.xml')"><span class="sub-option-icon"><img src="ICON/APT_BUNDLE4.PNG" alt="Resources Icon"></span>Spaces</div>
    </div>
</div>


<div class="sub-options-container">
    <div class="sub-options" id="sub-options-9">
        <div class="sub-option">
            <div onclick="loadPostInstallItems1()">
                <span class="sub-option-icon"><img src="ICON/1.PNG" alt="1 Icon"></span>List 1
            </div>
        </div>
        <div class="sub-option">
            <div onclick="loadPostInstallItems2()">
                <span class="sub-option-icon"><img src="ICON/2.PNG" alt="2 Icon"></span>List 2
            </div>
           
        </div>
        <div class="sub-option">
            <div onclick="loadPostInstallItems3()">
                <span class="sub-option-icon"><img src="ICON/3.PNG" alt="3 Icon"></span>List 3
            </div>
           
        </div>
        <div class="sub-option">
            <div onclick="loadPostInstallItems4()">
                <span class="sub-option-icon"><img src="ICON/4.PNG" alt="4 Icon"></span>List 4
            </div>
           
        </div>
        <div class="sub-option">
            <div onclick="loadPostInstallItems5()">
                <span class="sub-option-icon"><img src="ICON/5.PNG" alt="5 Icon"></span>List 5
            </div>
           
        </div>
    </div>
</div>

<div class="search-options-container">
    <div class="sub-options" id="sub-options-10">
        <input type="text" id="keywordInput" placeholder="eg. 'female/torso red lockwood' or 'furniture/sofa veemee hdk_1.8'">
        <button class="go-button" onclick="searchFolder()">Go</button>
  
    </div>
</div>


</div>
<div id="postinstallPopup" style="display: none;">
    <h3 class="row-label">POSTINSTALL.SQL Generator 2.0</h3>
	<div>
        <button class="sqlsortbutton" onclick="sortByUUID()">Sort by UUID</button>
        <button class="sqlsortbutton" onclick="sortByName()">Sort by Name</button>
        <button class="sqlsortbutton" onclick="sortByType()">Sort by Type</button>
        <button class="sqlsortbutton" onclick="sortByCategory()">Sort by Category</button>
    </div>
    <div><textarea id="premium" spellcheck="false" placeholder="Enter UUIDs - Or Drag and Drop SQL/XML/TXT files here to upload"></textarea></div>
	<div class="itemtypecounts" id="itemCounts">
    Total Items: <span id="totalItems">0</span> | 
    Rewards: <span id="rewardsCount">0</span> | 
    Non Rewards: <span id="nonRewardsCount">0</span>
</div>
    <div>
        <button class="buttons2" onclick="saveToLocalStorage(); clearArray(); loadFromLocalStorage()" title="This button saves the current array of UUIDS to the browsers localstorage cache for loading in another session">Save</button>
		<button class="buttons2" id="clearArrayButton" onclick="clearArray(); saveToLocalStorage()" title="This button clears the UUID input box and the local storage, use undo if you clear by mistake">Clear</button>
		<button class="buttons2" id="undoButton" onclick="undoTextareaChange()" title="This button undoes the last change to the text area, only remembers last 100 steps, you must click Save to confirm undo state and update grid">Undo</button>

        <!-- New buttons for.txt files -->
        <button class="buttons2" onclick="saveAsTxtFile()" title="This button downloads a TXT file with your current UUID list for uploading later, This is useful in case the browsers cache gets cleared">Backup to TXT</button>
		<input type="file" id="sqlFileInput" style="display: none;" onchange="extractUUIDsFromFile(event)">
		<button class="buttons2" onclick="document.getElementById('sqlFileInput').click()" title="Use this button to upload a previously saved list of UUIDs in almost any file type, it will scan the file for strings matching the UUID format. Note it will append the uploaded items to the current list so you can use this to combine lists">Upload SQL/TXT/XML</button>
		<button class="buttons2" onclick="cleanTextArea(); saveToLocalStorage(); clearArray(); loadFromLocalStorage()" title="Use this button to remove bundles and duplicates from your list to save space for other items">Clean List</button>
    </div>
    <!-- Wrap the "Generate SQL" button in a div -->
    <div id="sqlOutputContainer">
    <div id="sqlOutput"></div>
	</div>
    <!-- Wrap the "Copy SQL" and "Download SQL" buttons in a div -->
    <div class="button-group">
		<button class="buttons2" onclick="generateSQL()" title="This button generates a POSTINSTALL.SQL with the UUIDs in the input box. Rewards and Premium items will be added to the correct table">Generate SQL</button>
        <a class="downloadbutton" id="downloadSqlButton" download="POSTINSTALL.SQL" title="Download POSTINSTALL.SQL, Then you must manually install it to dev_hdd0/game/NPIA00005/USRDIR/OBJECTCATALOGUE/">Download SQL</a>
        <button class="buttons2" id="closeButton" onclick="togglePostinstallPopup()" title="Hide Tool - it will remember the UUIDs during this session, click save to ensure it remembers for the next session too">Hide Tool</button>
    </div>
</div>

<div class="button-row">
		<button class="low-profile-button" id="sort-by-nice">Sort by Name</button>
		<button class="low-profile-button" id="sort-by-folder">Sort by UUID</button>
	</div>
<div id="context-menu" class="context-menu">
    <ul>
        <li onclick="PostInstallFunction1()">Add to List 1</li>
        <li onclick="PostInstallFunction2()">Add to List 2</li>
        <li onclick="PostInstallFunction3()">Add to List 3</li>
        <li onclick="PostInstallFunction4()">Add to List 4</li>
        <li onclick="PostInstallFunction5()">Add to List 5</li>
        <li onclick="PostInstallFunctionAll()">Add to All</li>
        <li onclick="PostInstallFunctionRemAll()">Remove from All</li>
    </ul>
</div>


<!-- New Context Menu for sub-options-9 -->
<div id="special-context-menu" class="context-menu">
    <ul>
        <li onclick="sendToPS3()">Push Direct to PS3</li>
        <li onclick="sendToRPCS3()">Push Direct to RPCS3</li>
		<li onclick="SaveAsPKG()">Save List as PKG</li>
		<li onclick="SaveAsSQL()">Save List as SQL</li>
		<input type="file" id="fileInput" accept=".sql,.txt,.scene,.xml,.csv,.json" style="display:none" />
		<li onclick="LoadInSQL()">Upload SQL/XML/TXT</li>
        <li onclick="clearList()">Clear this List</li>
    </ul>
</div>



<div class="wrapper">
<div class="grid-container" id="grid-container"></div>
</div>
</div>
<script>
const container = document.getElementById('gui-container');
const icons = container.getElementsByClassName('gui-icon');
const iconsCount = icons.length;
const subOptionsContainers = document.querySelectorAll('.sub-options');
let activeIndex = 10;
let isSubOptionActive = false;
let currentSubOptionIndices = Array.from({ length: iconsCount }, () => 0);
let copiedItems = JSON.parse(localStorage.getItem('copiedItems')) || [];
let currentSortOrder = 'folderNameAsc'; // Initial sort order
let lastLoadedFolder = ''; // To track the last loaded folder


function updateActiveIcon() {
    for (let i = 0; i < iconsCount; i++) {
        icons[i].classList.remove('active');
    }
    icons[activeIndex].classList.add('active');
}

function updateActiveSubOption() {
    for (let i = 0; i < iconsCount; i++) {
        const subOptionsContainer = document.getElementById('sub-options-' + i);
        if (subOptionsContainer) {
            if (i === activeIndex) {
                subOptionsContainer.style.display = 'flex';
                const subOptions = subOptionsContainer.querySelectorAll('.sub-option');
                for (let j = 0; j < subOptions.length; j++) {
                    if (j === currentSubOptionIndices[i]) {
                        subOptions[j].classList.add('active-option');
                    } else {
                        subOptions[j].classList.remove('active-option');
                    }
                }
            } else {
                subOptionsContainer.style.display = 'none';
            }
        }
    }
}

function loadLastActiveSubOption(index) {
    activeIndex = index;
    isSubOptionActive = true;
    updateActiveIcon();
    const subOptionIndex = currentSubOptionIndices[index];
    const subOptionsContainer = document.getElementById('sub-options-' + index);
    const subOptions = subOptionsContainer.querySelectorAll('.sub-option');
    if (subOptions[subOptionIndex]) {
        if (index === 9) {
            switch (subOptionIndex) {
                case 0:
                    loadPostInstallItems1();
                    break;
                case 1:
                    loadPostInstallItems2();
                    break;
                case 2:
                    loadPostInstallItems3();
                    break;
                case 3:
                    loadPostInstallItems4();
                    break;
                case 4:
                    loadPostInstallItems5();
                    break;
            }
        } else {
            subOptions[subOptionIndex].click();
        }
    } else {
        loadFolder('default-folder.xml'); // Replace with your default folder if necessary
    }
}



let isUndoAction = false; // Flag to indicate an undo action

let textareaHistory = JSON.parse(localStorage.getItem('textareaHistory')) || [];
let currentHistoryIndex = parseInt(localStorage.getItem('currentHistoryIndex'), 10) || -1;
const MAX_HISTORY_SIZE = 100;
let isUndoRedoAction = false;

document.getElementById('premium').addEventListener('input', function() {
    if (!isUndoRedoAction) {
        // If new input is made after undo/redo, remove future history
        if (currentHistoryIndex < textareaHistory.length - 1) {
            textareaHistory = textareaHistory.slice(0, currentHistoryIndex + 1);
        }

        // Add new state and update current index
        textareaHistory.push(this.value);
        currentHistoryIndex = textareaHistory.length - 1;

        // Ensure history doesn't exceed max size
        if (textareaHistory.length > MAX_HISTORY_SIZE) {
            textareaHistory.shift();
            currentHistoryIndex--; // Adjust index as history array is shifted
        }

        // Save history to local storage
        localStorage.setItem('textareaHistory', JSON.stringify(textareaHistory));
        localStorage.setItem('currentHistoryIndex', currentHistoryIndex);

        // Call other necessary functions here, like updating names
        // reAddNames(); // Uncomment if you have a function like this
    }
    isUndoRedoAction = false; // Reset flag after processing
});

function cleanTextArea() {
    const textarea = document.getElementById('premium');
    const lines = textarea.value.split('\n');
    const bundleKeywords = ['Clothing_Bundle', 'Male_Bundle', 'Female_Bundle', 'Furniture_Bundle', 'Animation_Bundle', 'Locomotion_Bundle', 'Companion_Bundle', 'Apt_Bundle']; // Add more keywords as needed

    // Create a map to keep track of UUID occurrences
    let uuidMap = {};

    // First pass: Identify duplicates
    lines.forEach((line, index) => {
        let uuid = line.substring(0, 35);
        if (!uuidMap[uuid]) {
            uuidMap[uuid] = [];
        }
        uuidMap[uuid].push(index);
    });

    // Filter out lines with duplicates and bundle keywords
    const filteredLines = lines.filter((line, index) => {
        let uuid = line.substring(0, 35);
        // Keep the line if it does not include bundle keywords and is either not a duplicate or is the first occurrence of a duplicate
        return !bundleKeywords.some(keyword => line.includes(keyword)) && (uuidMap[uuid].length === 1 || uuidMap[uuid][0] === index);
    });

    textarea.value = filteredLines.join('\n');
}

function updateCopiedItemsFromTextarea() {
    const textareaContent = document.getElementById('premium').value;
    window.copiedItems = textareaContent.split('\n').filter(item => item.trim().length > 0);
    localStorage.setItem('copiedItems', JSON.stringify(window.copiedItems));
}

function undoTextareaChange() {
    if (currentHistoryIndex > 0) {
        currentHistoryIndex--;
        const previousState = textareaHistory[currentHistoryIndex];
        document.getElementById('premium').value = previousState;

        isUndoRedoAction = true;
        document.getElementById('premium').dispatchEvent(new Event('input'));

        saveToLocalStorage();
        updateCopiedItemsFromTextarea(); // Update copiedItems array
    } else {
        console.log("No more undo history available.");
    }
}


// Global variable to store the data14 content
var data14Content = {};

// Async function to load data14 file and parse its content into an object for quick lookup
async function loadData14File() {
    // Check if data14Content is already loaded
    if (Object.keys(data14Content).length > 0) {
        console.log("data14 content already loaded. Using cached data.");
        return;
    }

    console.log("Attempting to fetch data file...");
    const url = 'categories/All_Items.xml';
    try {
        const response = await fetch(url);
        if (!response.ok) {
            throw new Error(`HTTP error! Status: ${response.status}`);
        }
        const text = await response.text();
        parseData14File(text);
        console.log("data14 file loaded and parsed successfully.");
    } catch (error) {
        console.error('Error loading data14 file:', error);
    }
}

function parseData14File(text) {
    const lines = text.trim().split('\n');
    lines.forEach(line => {
        const parts = line.split('|');
        if (parts.length >= 9) {
            const uuid = parts[0].trim();
            const name = parts[3].trim();
            let sixthValue = parts[5].trim();
            const ninthValue = parts[8].trim();


            data14Content[uuid] = { name, sixthValue, ninthValue };
        }
    });
}



window.onload = async function() {
    // First load the data14 file
    await loadData14File();

    // Then load from local storage
    loadFromLocalStorage();
};

function loadFromLocalStorage() {
    const storedContent = localStorage.getItem('premiumTextareaContent');
    if (storedContent) {
        const textarea = document.getElementById('premium');
        textarea.value = storedContent;
        textarea.dispatchEvent(new Event('input')); // Manually dispatch the input event

        // Update the copiedItems array with the content from localStorage
        window.copiedItems = storedContent.split('\n').map(item => item.trim());

        // Call checkAndUpdateTextArea to update the counts
        checkAndUpdateTextArea();

        console.log("Data loaded from local storage and counts updated.");
    }
}

function checkAndUpdateTextArea() {
    console.log("Checking textarea for changes...");
    const textarea = document.getElementById('premium');
    let lines = textarea.value.split('\n');
    let uniqueLines = Array.from(new Set(lines)); // Remove duplicate lines
    let updated = false;

    let totalItems = 0;
    let rewardsCount = 0;

    for (let i = 0; i < uniqueLines.length; i++) {
        const uuid = uniqueLines[i].split(' ')[0];
        if (uuid.length === 35 && data14Content[uuid]) {
            console.log(`Detected UUID: ${uuid}`);
            const data = data14Content[uuid];
            if (!uniqueLines[i].includes('|')) {
                console.log(`Found data for UUID ${uuid}`);
                let sixthValue = data.sixthValue;
                let name = data.name;

                // Pad or trim the 6th value
                sixthValue = sixthValue.length > 22 ? sixthValue.substring(0, 22) : sixthValue.padEnd(22, ' ');

                // Pad or trim the name
                name = name.length > 52 ? name.substring(0, 52) : name.padEnd(52, ' ');

                const paddedNinthValue = data.ninthValue.padEnd(11, ' '); // Pad the 9th value
                uniqueLines[i] = uuid + ' | ' + name + ' | ' + paddedNinthValue + ' | ' + sixthValue; // Update line format
                updated = true;
            }
        } else if (uuid.length === 35) {
            console.log(`No data found for UUID ${uuid}`);
        }

        // Counting logic
        totalItems++;
        if (uniqueLines[i].includes("AUTO_REWARD") || uniqueLines[i].includes("LUA_REWARD")) {
            rewardsCount++;
        }
    }

    let nonRewardsCount = totalItems - rewardsCount;

    // Update counts in HTML
    document.getElementById('totalItems').textContent = totalItems;
    document.getElementById('rewardsCount').textContent = rewardsCount;
    document.getElementById('nonRewardsCount').textContent = nonRewardsCount;

    if (updated) {
        textarea.value = uniqueLines.join('\n');
        console.log("Textarea updated with additional data and names.");
    } else {
        console.log("No updates made to the textarea.");
    }
}

function loadDefaultFolder() {
    gridContainer.innerHTML = '';

    // Get the current URL
    var currentURL = window.location.href;

    // Find the index of the '?' character
    var queryIndex = currentURL.indexOf('?');

    // If '?' is found, extract the XML path after it
    if (queryIndex !== -1) {
        var xmlPath = currentURL.substring(queryIndex + 1);
        fetchFolderData(xmlPath);
    } else {
        // If '?' is not found, use a default XML path
        var defaultXMLPath = 'categories/Portable_Companion.xml';
        console.log("No XML path found in the URL. Using default XML path:", defaultXMLPath);
        fetchFolderData(defaultXMLPath);
    }
}


document.addEventListener('keydown', function (event) {
    if (event.key === 'ArrowLeft' || event.keyCode === 37) {
        if (isSubOptionActive) {
            if (currentSubOptionIndices[activeIndex] > 0) {
                currentSubOptionIndices[activeIndex]--;
                updateActiveSubOption(); // Update the active sub-option immediately
            }
        } else {
            if (activeIndex > 0) {
                activeIndex--;
                updateActiveIcon();
                updateActiveSubOption();
            }
        }
    } else if (event.key === 'ArrowRight' || event.keyCode === 39) {
        if (isSubOptionActive) {
            const subOptions = subOptionsContainers[activeIndex].querySelectorAll('.sub-option');
            if (currentSubOptionIndices[activeIndex] < subOptions.length - 1) {
                currentSubOptionIndices[activeIndex]++;
                updateActiveSubOption(); 
            }
        } else {
            if (activeIndex < iconsCount - 1) {
                activeIndex++;
                updateActiveIcon();
                updateActiveSubOption();
              
            }
        }
    } else if (event.key === 'ArrowDown' || event.keyCode === 40) {
        isSubOptionActive = true;
        // Add your logic for handling down arrow
    } else if (event.key === 'ArrowUp' || event.keyCode === 38) {
        if (isSubOptionActive) {
            isSubOptionActive = false;
            updateActiveSubOption();
          
        }
    }
});

updateActiveIcon();
updateActiveSubOption();


document.addEventListener('DOMContentLoaded', function() {
            // Disable the default context menu everywhere
            document.addEventListener('contextmenu', function(event) {
                event.preventDefault();
            });

            // Existing functionality
            for (let i = 0; i < iconsCount; i++) {
                icons[i].addEventListener('click', function() {
                    activeIndex = i;
                    isSubOptionActive = false;
                    updateActiveIcon();
                    updateActiveSubOption();
                });

                const subOptionsContainer = document.getElementById('sub-options-' + i);
                if (subOptionsContainer) {
                    const subOptions = subOptionsContainer.querySelectorAll('.sub-option');
                    for (let j = 0; j < subOptions.length; j++) {
                        subOptions[j].addEventListener('click', function() {
                            currentSubOptionIndices[activeIndex] = j;
                            updateActiveSubOption();
                        });
                    }
                }
            }

            // Initialize context menu functionality
            initContextMenu();
            initSpecialContextMenu();
        });
	
function showContextMenu(event, gridItem) {
    event.preventDefault();
    hideSpecialContextMenu();
    const contextMenu = document.getElementById('context-menu');
    const folderName = gridItem.querySelector('.folder-name').textContent.trim();

    // Update menu options based on the presence in the lists
    const menuOptions = contextMenu.querySelectorAll('li');
    menuOptions[0].textContent = list1.some(item => item.folderName === folderName) ? "Remove from List 1" : "Add to List 1";
    menuOptions[1].textContent = list2.some(item => item.folderName === folderName) ? "Remove from List 2" : "Add to List 2";
    menuOptions[2].textContent = list3.some(item => item.folderName === folderName) ? "Remove from List 3" : "Add to List 3";
    menuOptions[3].textContent = list4.some(item => item.folderName === folderName) ? "Remove from List 4" : "Add to List 4";
    menuOptions[4].textContent = list5.some(item => item.folderName === folderName) ? "Remove from List 5" : "Add to List 5";
    // No label changing for menuOptions[5] and menuOptions[6]
    // menuOptions[5].textContent = inAllLists ? "Remove from All" : "Add to All";
    menuOptions[5].textContent = "Add to All";
    menuOptions[6].textContent = "Remove from All";

    // Set context menu position
    contextMenu.style.top = `${event.clientY}px`;
    contextMenu.style.left = `${event.clientX}px`;

    // Show context menu
    contextMenu.style.display = 'block';

    // Store the current grid item for later use
    contextMenu.currentGridItem = gridItem;
}

// Initialize lists for the five functions
let list1 = JSON.parse(localStorage.getItem('list1')) || [];
let list2 = JSON.parse(localStorage.getItem('list2')) || [];
let list3 = JSON.parse(localStorage.getItem('list3')) || [];
let list4 = JSON.parse(localStorage.getItem('list4')) || [];
let list5 = JSON.parse(localStorage.getItem('list5')) || [];
let currentLoadedCollection = null;

// Function to save lists to local storage
function saveListsToLocalStorage() {
    localStorage.setItem('list1', JSON.stringify(list1));
    localStorage.setItem('list2', JSON.stringify(list2));
    localStorage.setItem('list3', JSON.stringify(list3));
    localStorage.setItem('list4', JSON.stringify(list4));
    localStorage.setItem('list5', JSON.stringify(list5));
}

// Function to print the list details
function printListDetails(list, listNumber) {
    console.log(`\nList ${listNumber} Details:`);
    list.forEach((item, index) => {
        console.log(`${index + 1}. Folder Name: ${item.folderName}, Nice Name: ${item.niceName}`);
    });
}

function PostInstallFunction1() {
    const contextMenu = document.getElementById('context-menu');
    const gridItem = contextMenu.currentGridItem;
    if (gridItem) {
        const folderName = gridItem.querySelector('.folder-name').textContent.trim();
        const niceName = gridItem.querySelector('.nice-name').textContent.trim();
        if (list1.some(item => item.folderName === folderName)) {
            list1 = list1.filter(item => item.folderName !== folderName);
            saveListsToLocalStorage();
            if (currentLoadedCollection === 'list1') {
                removeGridItem(folderName);
            }
        } else {
            list1.push({ folderName, niceName });
            saveListsToLocalStorage();
        }
        printListDetails(list1, 1);
    }
    hideContextMenu();
}

function PostInstallFunction2() {
    const contextMenu = document.getElementById('context-menu');
    const gridItem = contextMenu.currentGridItem;
    if (gridItem) {
        const folderName = gridItem.querySelector('.folder-name').textContent.trim();
        const niceName = gridItem.querySelector('.nice-name').textContent.trim();
        if (list2.some(item => item.folderName === folderName)) {
            list2 = list2.filter(item => item.folderName !== folderName);
            saveListsToLocalStorage();
            if (currentLoadedCollection === 'list2') {
                removeGridItem(folderName);
            }
        } else {
            list2.push({ folderName, niceName });
            saveListsToLocalStorage();
        }
        printListDetails(list2, 2);
    }
    hideContextMenu();
}

function PostInstallFunction3() {
    const contextMenu = document.getElementById('context-menu');
    const gridItem = contextMenu.currentGridItem;
    if (gridItem) {
        const folderName = gridItem.querySelector('.folder-name').textContent.trim();
        const niceName = gridItem.querySelector('.nice-name').textContent.trim();
        if (list3.some(item => item.folderName === folderName)) {
            list3 = list3.filter(item => item.folderName !== folderName);
            saveListsToLocalStorage();
            if (currentLoadedCollection === 'list3') {
                removeGridItem(folderName);
            }
        } else {
            list3.push({ folderName, niceName });
            saveListsToLocalStorage();
        }
        printListDetails(list3, 3);
    }
    hideContextMenu();
}

function PostInstallFunction4() {
    const contextMenu = document.getElementById('context-menu');
    const gridItem = contextMenu.currentGridItem;
    if (gridItem) {
        const folderName = gridItem.querySelector('.folder-name').textContent.trim();
        const niceName = gridItem.querySelector('.nice-name').textContent.trim();
        if (list4.some(item => item.folderName === folderName)) {
            list4 = list4.filter(item => item.folderName !== folderName);
            saveListsToLocalStorage();
            if (currentLoadedCollection === 'list4') {
                removeGridItem(folderName);
            }
        } else {
            list4.push({ folderName, niceName });
            saveListsToLocalStorage();
        }
        printListDetails(list4, 4);
    }
    hideContextMenu();
}

function PostInstallFunction5() {
    const contextMenu = document.getElementById('context-menu');
    const gridItem = contextMenu.currentGridItem;
    if (gridItem) {
        const folderName = gridItem.querySelector('.folder-name').textContent.trim();
        const niceName = gridItem.querySelector('.nice-name').textContent.trim();
        if (list5.some(item => item.folderName === folderName)) {
            list5 = list5.filter(item => item.folderName !== folderName);
            saveListsToLocalStorage();
            if (currentLoadedCollection === 'list5') {
                removeGridItem(folderName);
            }
        } else {
            list5.push({ folderName, niceName });
            saveListsToLocalStorage();
        }
        printListDetails(list5, 5);
    }
    hideContextMenu();
}

function PostInstallFunctionAll() {
    const contextMenu = document.getElementById('context-menu');
    const gridItem = contextMenu.currentGridItem;
    if (gridItem) {
        const folderName = gridItem.querySelector('.folder-name').textContent.trim();
        const niceName = gridItem.querySelector('.nice-name').textContent.trim();

        const addToListIfNotExists = (list) => {
            if (!list.some(item => item.folderName === folderName)) {
                list.push({ folderName, niceName });
            }
            return list;
        };

        list1 = addToListIfNotExists(list1);
        list2 = addToListIfNotExists(list2);
        list3 = addToListIfNotExists(list3);
        list4 = addToListIfNotExists(list4);
        list5 = addToListIfNotExists(list5);

        saveListsToLocalStorage();

        printListDetails(list1, 1);
        printListDetails(list2, 2);
        printListDetails(list3, 3);
        printListDetails(list4, 4);
        printListDetails(list5, 5);
    }
    hideContextMenu();
}

function PostInstallFunctionRemAll() {
    const contextMenu = document.getElementById('context-menu');
    const gridItem = contextMenu.currentGridItem;
    if (gridItem) {
        const folderName = gridItem.querySelector('.folder-name').textContent.trim();

        const removeFromListIfExists = (list) => {
            return list.filter(item => item.folderName !== folderName);
        };

        list1 = removeFromListIfExists(list1);
        list2 = removeFromListIfExists(list2);
        list3 = removeFromListIfExists(list3);
        list4 = removeFromListIfExists(list4);
        list5 = removeFromListIfExists(list5);

        saveListsToLocalStorage();

        printListDetails(list1, 1);
        printListDetails(list2, 2);
        printListDetails(list3, 3);
        printListDetails(list4, 4);
        printListDetails(list5, 5);

        // Remove the item from the active grid in real time
        removeGridItem(folderName);
    }
    hideContextMenu();
}


function hideContextMenu() {
    const contextMenu = document.getElementById('context-menu');
    contextMenu.style.display = 'none';
    contextMenu.currentGridItem = null;
}



function initContextMenu() {
    const gridContainer = document.getElementById('grid-container');
    const contextMenu = document.getElementById('context-menu');

    // Hide context menu when clicking outside of it
    document.addEventListener('click', function(event) {
        if (!contextMenu.contains(event.target)) {
            hideContextMenu();
        }
    });

    // Attach right-click event to grid items
    gridContainer.addEventListener('contextmenu', function(event) {
        const gridItem = event.target.closest('.grid-item');
        if (gridItem) {
            showContextMenu(event, gridItem);
        } else {
            hideContextMenu();
        }
    });
}

async function loadPostInstallItems1() {
    currentLoadedCollection = 'list1';
    gridContainer.innerHTML = ''; // No need to clear the grid container fully
    const folderXML = 'categories/All_Items.xml';
    try {
        const response = await fetch(folderXML);
        if (!response.ok) {
            throw new Error(`HTTP error! Status: ${response.status}`);
        }
        const text = await response.text();
        const lines = text.trim().split('\n');
        const folderNames = list1.map(item => item.folderName);
        const matchingItems = lines.filter(line => {
            const parts = line.split('|');
            if (parts.length > 0) {
                const folderName = parts[0].trim();
                return folderNames.includes(folderName);
            }
            return false;
        });
        matchingItems.forEach(line => {
            const parts = line.split('|');
            if (parts.length >= 4) {
                const folderName = parts[0].trim();
                const niceName = parts[3].trim();
                createGridItem(folderName, niceName);
            }
        });
    } catch (error) {
        console.error('Error fetching or processing the XML file:', error);
    }
}

async function loadPostInstallItems2() {
    currentLoadedCollection = 'list2';
    gridContainer.innerHTML = ''; // No need to clear the grid container fully
    const folderXML = 'categories/All_Items.xml';
    try {
        const response = await fetch(folderXML);
        if (!response.ok) {
            throw new Error(`HTTP error! Status: ${response.status}`);
        }
        const text = await response.text();
        const lines = text.trim().split('\n');
        const folderNames = list2.map(item => item.folderName);
        const matchingItems = lines.filter(line => {
            const parts = line.split('|');
            if (parts.length > 0) {
                const folderName = parts[0].trim();
                return folderNames.includes(folderName);
            }
            return false;
        });
        matchingItems.forEach(line => {
            const parts = line.split('|');
            if (parts.length >= 4) {
                const folderName = parts[0].trim();
                const niceName = parts[3].trim();
                createGridItem(folderName, niceName);
            }
        });
    } catch (error) {
        console.error('Error fetching or processing the XML file:', error);
    }
}

async function loadPostInstallItems3() {
    currentLoadedCollection = 'list3';
    gridContainer.innerHTML = ''; // No need to clear the grid container fully
    const folderXML = 'categories/All_Items.xml';
    try {
        const response = await fetch(folderXML);
        if (!response.ok) {
            throw new Error(`HTTP error! Status: ${response.status}`);
        }
        const text = await response.text();
        const lines = text.trim().split('\n');
        const folderNames = list3.map(item => item.folderName);
        const matchingItems = lines.filter(line => {
            const parts = line.split('|');
            if (parts.length > 0) {
                const folderName = parts[0].trim();
                return folderNames.includes(folderName);
            }
            return false;
        });
        matchingItems.forEach(line => {
            const parts = line.split('|');
            if (parts.length >= 4) {
                const folderName = parts[0].trim();
                const niceName = parts[3].trim();
                createGridItem(folderName, niceName);
            }
        });
    } catch (error) {
        console.error('Error fetching or processing the XML file:', error);
    }
}


async function loadPostInstallItems4() {
    currentLoadedCollection = 'list4';
    gridContainer.innerHTML = ''; // No need to clear the grid container fully
    const folderXML = 'categories/All_Items.xml';
    try {
        const response = await fetch(folderXML);
        if (!response.ok) {
            throw new Error(`HTTP error! Status: ${response.status}`);
        }
        const text = await response.text();
        const lines = text.trim().split('\n');
        const folderNames = list4.map(item => item.folderName);
        const matchingItems = lines.filter(line => {
            const parts = line.split('|');
            if (parts.length > 0) {
                const folderName = parts[0].trim();
                return folderNames.includes(folderName);
            }
            return false;
        });
        matchingItems.forEach(line => {
            const parts = line.split('|');
            if (parts.length >= 4) {
                const folderName = parts[0].trim();
                const niceName = parts[3].trim();
                createGridItem(folderName, niceName);
            }
        });
    } catch (error) {
        console.error('Error fetching or processing the XML file:', error);
    }
}

async function loadPostInstallItems5() {
    currentLoadedCollection = 'list5';
    gridContainer.innerHTML = ''; // No need to clear the grid container fully
    const folderXML = 'categories/All_Items.xml';
    try {
        const response = await fetch(folderXML);
        if (!response.ok) {
            throw new Error(`HTTP error! Status: ${response.status}`);
        }
        const text = await response.text();
        const lines = text.trim().split('\n');
        const folderNames = list5.map(item => item.folderName);
        const matchingItems = lines.filter(line => {
            const parts = line.split('|');
            if (parts.length > 0) {
                const folderName = parts[0].trim();
                return folderNames.includes(folderName);
            }
            return false;
        });
        matchingItems.forEach(line => {
            const parts = line.split('|');
            if (parts.length >= 4) {
                const folderName = parts[0].trim();
                const niceName = parts[3].trim();
                createGridItem(folderName, niceName);
            }
        });
    } catch (error) {
        console.error('Error fetching or processing the XML file:', error);
    }
}


function removeGridItem(folderName) {
    const gridItems = document.querySelectorAll('.grid-item');
    gridItems.forEach(item => {
        const itemFolderName = item.querySelector('.folder-name').textContent.trim();
        if (itemFolderName === folderName) {
            gridContainer.removeChild(item);
        }
    });
}


    function hideContextMenu() {
        const contextMenu = document.getElementById('context-menu');
        contextMenu.style.display = 'none';
        contextMenu.currentGridItem = null;
    }


let lastClickedButton = null;

function handleButtonClick(button) {
    if (lastClickedButton !== null) {
        lastClickedButton.classList.remove("active");
    }

    button.classList.add("active");
    lastClickedButton = button;
}

const buttons = document.querySelectorAll(".buttons button");
buttons.forEach((button) => {
    button.addEventListener("click", function () {
        handleButtonClick(button);
        loadFolder(button.dataset.folder);
    });
});

const gridContainer = document.getElementById('grid-container');
let gridItems = [];  // Initialize the gridItems array

function createGridItem(folderName, niceName) {
    const gridItem = document.createElement('div');
    gridItem.classList.add('grid-item');

    const iconImage = document.createElement('img');
    iconImage.classList.add('placeholder-image');
    const imageUrl = `http://psho.me/DATA/${folderName}/${folderName}.WEBP`;
    iconImage.src = imageUrl;
    iconImage.alt = 'Icon (Small)';
    iconImage.loading = 'lazy';

    const niceNameElement = document.createElement('div');
    niceNameElement.classList.add('nice-name');
    niceNameElement.textContent = niceName;
    niceNameElement.id = 'nice-name';

    const folderNameElement = document.createElement('div');
    folderNameElement.classList.add('folder-name');
    folderNameElement.textContent = folderName;
    folderNameElement.id = 'folder-name';

    gridItem.appendChild(iconImage);
    gridItem.appendChild(niceNameElement);
    gridItem.appendChild(folderNameElement);

    niceNameElement.addEventListener('click', function (event) {
        event.stopPropagation();
        if (event.ctrlKey) {
            openInNewTab(folderName);
        } else {
            copyToClipboardAndShowCopied(folderNameElement);
        }
    });

    folderNameElement.addEventListener('click', function (event) {
        event.stopPropagation();
        if (event.ctrlKey) {
            openInNewTab(folderName);
        } else {
            copyToClipboardAndShowCopied(folderNameElement);
        }
    });

    gridItem.addEventListener('click', function (event) {
        if (event.ctrlKey) {
            openInNewTab(folderName);
        } else {
            redirectToItemPage(folderName);
        }
    });

    

    gridContainer.appendChild(gridItem);

    gridItems.push(gridItem); // Push the gridItem into the gridItems array
}

function redirectToItemPage(folderName) {
    const itemPageURL = `pshome_uuid.html?${encodeURIComponent(folderName)}`;
    window.location.href = itemPageURL;
}

function openInNewTab(folderName) {
    const itemPageURL = `pshome_uuid.html?${encodeURIComponent(folderName)}`;
    window.open(itemPageURL, '_blank');
}


// Function to sort items by folderName
let sortOrderFolder = 0; // 0: folderName asc, 1: folderName desc
let sortOrderNice = 0; // 0: niceName asc, 1: niceName desc

// Function to sort items by folderName
function sortByFolderName() {
    let sortedItems;
    if (sortOrderFolder === 0) {
        sortedItems = gridItems.sort((a, b) => {
            const nameA = a.querySelector('.folder-name').textContent.toUpperCase();
            const nameB = b.querySelector('.folder-name').textContent.toUpperCase();
            return nameA.localeCompare(nameB);
        });
        sortOrderFolder = 1;
    } else {
        sortedItems = gridItems.sort((a, b) => {
            const nameA = a.querySelector('.folder-name').textContent.toUpperCase();
            const nameB = b.querySelector('.folder-name').textContent.toUpperCase();
            return nameB.localeCompare(nameA);
        });
        sortOrderFolder = 0;
    }

    // Clear the grid container
    while (gridContainer.firstChild) {
        gridContainer.removeChild(gridContainer.lastChild);
    }

    // Reappend the sorted items to the grid container
    sortedItems.forEach(item => {
        gridContainer.appendChild(item);
    });
}

// Function to sort items by niceName
function sortByNiceName() {
    const customSorting = (a, b) => {
        const nameA = a.querySelector('.nice-name').textContent.toUpperCase().replace(/['"“”]/g, '');
        const nameB = b.querySelector('.nice-name').textContent.toUpperCase().replace(/['"“”]/g, '');

        if (nameA < nameB) {
            return -1;
        }
        if (nameA > nameB) {
            return 1;
        }
        return 0;
    };

    let sortedItems;
    if (sortOrderNice === 0) {
        sortedItems = gridItems.sort(customSorting);
        sortOrderNice = 1;
    } else {
        sortedItems = gridItems.sort((a, b) => customSorting(b, a));
        sortOrderNice = 0;
    }

    // Clear the grid container
    while (gridContainer.firstChild) {
        gridContainer.removeChild(gridContainer.lastChild);
    }

    sortedItems.forEach(item => {
        gridContainer.appendChild(item);
    });
}


if (!window.copiedItems) {
    window.copiedItems = [];
}


function createClickableLinks(items) {
    return items.map(item => `<a href="#" onclick="handleItemClick(event)">${item}</a>`);
}
function handleItemClick(event) {
    const clickedItem = event.target.textContent;
    // Handle click action for the clicked item as needed
    console.log("Clicked item:", clickedItem);
    // For example, you can open a new window with the link or perform any other action
}

function displayCopiedItems() {
    let copiedItemsString = "";
    for (let i = 0; i < copiedItems.length; i++) {
        copiedItemsString += copiedItems[i] + "\n";
    }

    console.log("Copied Items:");
    console.log(copiedItemsString);
}


function searchFolder() {
    gridContainer.innerHTML = '';
    const folderXML = 'categories/All_Items.xml';
    const keyword = document.getElementById('keywordInput').value.trim();
    fetchFolderData(folderXML, keyword);
}

document.getElementById('keywordInput').addEventListener('keypress', function (e) {
    if (e.key === 'Enter') {
        searchFolder();
    }
});


async function fetchFolderData(folderXML, filterByKeyword) {
    try {
        const isLocal = window.location.protocol === 'file:';

        let text;
        if (isLocal) {
            text = await loadLocalFile(folderXML);
        } else {
            const response = await fetch(folderXML);
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            text = await response.text();
        }

        const lines = text.trim().split('\n');
        console.log(`Found ${lines.length} entries in XML.`);

        gridItems.length = 0;

        const items = [];

        // List of strings to exclude
        const excludeStrings = [
            "Arcade/Machine", "Minigame", "Minigame/Targetable", "Embedded/Objects",
            "Core", "Resource/Packs", "Worldmap/Objects", "Launching/Object",
            "Male_Bundle", "Female_Bundle", "Clothing_Bundle", "Furniture_Bundle",
            "Animation_Bundle", "Locomotion_Bundle", "Companion_Bundle", "Apt_Bundle"
        ];

        lines.forEach(line => {
            const values = line.split('|');
            if (values.length >= 9) {
                const folderName = values[0].trim();
                const niceName = values[3].trim();
                const sixthPart = values[5].trim();

                // Check if the line should be excluded
                const shouldExclude = excludeStrings.some(excludeString => sixthPart.includes(excludeString));

                if (!shouldExclude) {
                    const lowercaseLine = line.toLowerCase();
                    const lowercaseKeywords = filterByKeyword ? filterByKeyword.toLowerCase().split(" ") : [];

                    const matchedTerms = lowercaseKeywords.every(keyword => lowercaseLine.includes(keyword));

                    if (!filterByKeyword || (filterByKeyword && filterByKeyword.length >= 2 && matchedTerms)) {
                        items.push({ folderName, niceName });
                    }
                }
            } else {
                console.error('Invalid data found in line:', line);
            }
        });

        // Sorting based on currentSortOrder
        if (currentSortOrder === 'folderNameAsc') {
            items.sort((a, b) => a.folderName.localeCompare(b.folderName));
        } else if (currentSortOrder === 'niceNameAsc') {
            items.sort((a, b) => a.niceName.localeCompare(b.niceName));
        }

        items.forEach(item => {
            createGridItem(item.folderName, item.niceName);
        });

        gridItems = Array.from(gridContainer.children);

        const minItems = 8;
        const currentItemsCount = gridItems.length;
        if (currentItemsCount < minItems) {
            for (let i = currentItemsCount; i < minItems; i++) {
                createEmptyGridItem();
            }
        }
    } catch (error) {
        console.error('Error fetching XML:', error);
    }
}

function loadLocalFile(filePath) {
    return new Promise((resolve, reject) => {
        const xhr = new XMLHttpRequest();
        xhr.open('GET', filePath, true);
        xhr.onreadystatechange = function() {
            if (xhr.readyState === 4) {
                if (xhr.status === 200 || xhr.status === 0) {
                    resolve(xhr.responseText);
                } else {
                    reject(new Error(`Error loading local file: ${xhr.statusText}`));
                }
            }
        };
        xhr.send(null);
    });
}

// Function to create an empty grid item
function createEmptyGridItem() {
    const gridItem = document.createElement('div');
    gridItem.classList.add('grid-item');
    gridItem.style.visibility = 'hidden'; // Make it invisible but occupy space

    gridContainer.appendChild(gridItem);
    gridItems.push(gridItem); // Push the gridItem into the gridItems array
}




        function redirectToItemPage(folderName) {
            const itemPageURL = `pshome_uuid.html?${encodeURIComponent(folderName)}`;
            window.location.href = itemPageURL;
        }
		

// Call loadDefaultFolder on page load
loadDefaultFolder();

// Add event listener for popstate event (back/forward button pressed)
window.addEventListener('popstate', function() {
    loadDefaultFolder();
});


function loadFolder(folderXML) {
    if (lastLoadedFolder === folderXML) {
        // Toggle the sort order if the same folder is clicked
        if (currentSortOrder === 'folderNameAsc') {
            currentSortOrder = 'niceNameAsc';
        } else {
            currentSortOrder = 'folderNameAsc';
        }
    } else {
        // Reset to default sort order if a different folder is clicked
        currentSortOrder = 'folderNameAsc';
    }

    lastLoadedFolder = folderXML; // Update the last loaded folder

    gridContainer.innerHTML = '';
    fetchFolderData(folderXML);

    // Assuming you want to update the URL when the folder is loaded
    updateURLWithXMLFlag(folderXML);
}

function updateURLWithXMLFlag(xmlFileName) {
    var newURL = window.location.href.split('?')[0] + '?' + xmlFileName;
    window.history.pushState({ xml: xmlFileName }, document.title, newURL);
}



document.querySelector('.gui-container').addEventListener('wheel', function(event) {
    if (event.ctrlKey) {
        event.preventDefault();
    }
}, { passive: false });

document.querySelectorAll('.gui-icon').forEach(function(icon) {
    icon.addEventListener('wheel', function(event) {
        if (event.ctrlKey) {
            event.preventDefault();
        }
    }, { passive: false });
});

function showSpecialContextMenu(event, element) {
    event.preventDefault();
    hideContextMenu();
    const contextMenu = document.getElementById('special-context-menu');

    // Set context menu position
    contextMenu.style.top = `${event.clientY}px`;
    contextMenu.style.left = `${event.clientX}px`;

    // Show context menu
    contextMenu.style.display = 'block';

    // Store the current element and index for later use
    contextMenu.currentElement = element;
    contextMenu.currentIndex = Array.from(element.parentNode.children).indexOf(element);
}


function hideSpecialContextMenu() {
    const contextMenu = document.getElementById('special-context-menu');
    contextMenu.style.display = 'none';
    contextMenu.currentElement = null;
}

function showNotification(message) {
    const notification = document.createElement('div');
    notification.className = 'notification';
    notification.innerText = message;
    document.body.appendChild(notification);

    setTimeout(() => {
        notification.remove();
    }, 3000);
}

function sendToPS3() {
    console.log('Send to PS3');

    const contextMenu = document.getElementById('special-context-menu');
    const subOption = contextMenu.currentElement;
    if (!subOption) return;

    const index = Array.from(subOption.parentNode.children).indexOf(subOption);
    let listToSend = [];

    switch (index) {
        case 0:
            listToSend = list1;
            break;
        case 1:
            listToSend = list2;
            break;
        case 2:
            listToSend = list3;
            break;
        case 3:
            listToSend = list4;
            break;
        case 4:
            listToSend = list5;
            break;
        default:
            console.error('Invalid list index');
            return;
    }

    window.chrome.webview.postMessage(JSON.stringify({ action: 'sendToPS3', index: index + 1, data: listToSend }));
    hideSpecialContextMenu();
}




function sendToRPCS3() {
    console.log('Send to RPCS3');

    const contextMenu = document.getElementById('special-context-menu');
    const subOption = contextMenu.currentElement;
    if (!subOption) return;

    const index = Array.from(subOption.parentNode.children).indexOf(subOption);
    let listToSend = [];

    switch (index) {
        case 0:
            listToSend = list1;
            break;
        case 1:
            listToSend = list2;
            break;
        case 2:
            listToSend = list3;
            break;
        case 3:
            listToSend = list4;
            break;
        case 4:
            listToSend = list5;
            break;
        default:
            console.error('Invalid list index');
            return;
    }

    window.chrome.webview.postMessage(JSON.stringify({ action: 'sendToRPCS3', index: index + 1, data: listToSend }));
	hideSpecialContextMenu();
}

function clearList() {
    const contextMenu = document.getElementById('special-context-menu');
    const subOption = contextMenu.currentElement;

    if (subOption) {
        const index = Array.from(subOption.parentNode.children).indexOf(subOption);
        
        switch(index) {
            case 0:
                list1 = [];
                localStorage.setItem('list1', JSON.stringify(list1));
                if (currentLoadedCollection === 'list1') {
                    clearGrid();
                }
                break;
            case 1:
                list2 = [];
                localStorage.setItem('list2', JSON.stringify(list2));
                if (currentLoadedCollection === 'list2') {
                    clearGrid();
                }
                break;
            case 2:
                list3 = [];
                localStorage.setItem('list3', JSON.stringify(list3));
                if (currentLoadedCollection === 'list3') {
                    clearGrid();
                }
                break;
            case 3:
                list4 = [];
                localStorage.setItem('list4', JSON.stringify(list4));
                if (currentLoadedCollection === 'list4') {
                    clearGrid();
                }
                break;
            case 4:
                list5 = [];
                localStorage.setItem('list5', JSON.stringify(list5));
                if (currentLoadedCollection === 'list5') {
                    clearGrid();
                }
                break;
        }

        console.log(`Cleared List ${index + 1}`);
    }

    hideSpecialContextMenu();
}

function clearGrid() {
    const gridContainer = document.getElementById('grid-container');
    gridContainer.innerHTML = '';
}

function SaveAsSQL() {
            console.log('Save as SQL');

            const contextMenu = document.getElementById('special-context-menu');
            const subOption = contextMenu.currentElement;
            if (!subOption) return;

            const index = Array.from(subOption.parentNode.children).indexOf(subOption);
            let listToSend = [];

            switch (index) {
                case 0:
                    listToSend = list1;
                    break;
                case 1:
                    listToSend = list2;
                    break;
                case 2:
                    listToSend = list3;
                    break;
                case 3:
                    listToSend = list4;
                    break;
                case 4:
                    listToSend = list5;
                    break;
                default:
                    console.error('Invalid list index');
                    return;
            }

            window.chrome.webview.postMessage(JSON.stringify({ action: 'saveAsSQL', index: index + 1, data: listToSend }));
        }
		
function SaveAsPKG() {
        console.log('Save as PKG');

        const contextMenu = document.getElementById('special-context-menu');
        const subOption = contextMenu.currentElement;
        if (!subOption) return;

        const index = Array.from(subOption.parentNode.children).indexOf(subOption);
        let listToSend = [];

        switch (index) {
            case 0:
                listToSend = list1;
                break;
            case 1:
                listToSend = list2;
                break;
            case 2:
                listToSend = list3;
                break;
            case 3:
                listToSend = list4;
                break;
            case 4:
                listToSend = list5;
                break;
            default:
                console.error('Invalid list index');
                return;
        }

        window.chrome.webview.postMessage(JSON.stringify({ action: 'saveAsPKG', index: index + 1, data: listToSend }));
        hideSpecialContextMenu();
    }

    window.chrome.webview.addEventListener('message', async event => {
        const message = JSON.parse(event.data);
        if (message.action === 'downloadPkgFile') {
            const byteCharacters = atob(message.fileContent);
            const byteNumbers = new Array(byteCharacters.length);
            for (let i = 0; i < byteCharacters.length; i++) {
                byteNumbers[i] = byteCharacters.charCodeAt(i);
            }
            const byteArray = new Uint8Array(byteNumbers);
            const blob = new Blob([byteArray], { type: 'application/octet-stream' });

            try {
                const handle = await window.showSaveFilePicker({
                    suggestedName: message.fileName,
                    types: [
                        {
                            description: 'PKG Files',
                            accept: {
                                'application/octet-stream': ['.pkg'],
                            },
                        },
                    ],
                });

                const writableStream = await handle.createWritable();
                await writableStream.write(blob);
                await writableStream.close();
                console.log('File saved successfully');
            } catch (error) {
                console.error('Error saving file:', error);
            }
        }
        hideSpecialContextMenu();
    });

function initSpecialContextMenu() {
    const userListSubOptions = document.querySelectorAll('#sub-options-9 .sub-option');
    const contextMenu = document.getElementById('special-context-menu');

    // Hide context menu when clicking outside of it
    document.addEventListener('click', function(event) {
        if (!contextMenu.contains(event.target)) {
            hideSpecialContextMenu();
        }
    });

    // Attach right-click event to user list sub-options for the special context menu
    userListSubOptions.forEach(subOption => {
        subOption.addEventListener('contextmenu', function(event) {
            showSpecialContextMenu(event, subOption);
        });
    });
}

window.chrome.webview.addEventListener('message', async event => {
    const message = JSON.parse(event.data);
    if (message.action === 'downloadSqlFile') {
        const byteCharacters = atob(message.fileContent);
        const byteNumbers = new Array(byteCharacters.length);
        for (let i = 0; i < byteCharacters.length; i++) {
            byteNumbers[i] = byteCharacters.charCodeAt(i);
        }
        const byteArray = new Uint8Array(byteNumbers);
        const blob = new Blob([byteArray], { type: 'application/sql' });

        try {
            const handle = await window.showSaveFilePicker({
                suggestedName: message.fileName,
                types: [
                    {
                        description: 'SQL Files',
                        accept: {
                            'application/sql': ['.sql'],
                        },
                    },
                ],
            });

            const writableStream = await handle.createWritable();
            await writableStream.write(blob);
            await writableStream.close();
            console.log('File saved successfully');
        } catch (error) {
            console.error('Error saving file:', error);
        }
    }
	    hideSpecialContextMenu();
});



function LoadInSQL() {
    document.getElementById('fileInput').click();
    hideSpecialContextMenu();
}

document.getElementById('fileInput').addEventListener('change', handleFileSelect);

async function handleFileSelect(event) {
    const file = event.target.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = async function(e) {
            const content = e.target.result;
            const uuids = extractUUIDs(content);
            console.log('Extracted UUIDs:', uuids);

            const items = await fetchItemDetails(uuids);
            console.log('Fetched Items:', items);

            updateGridWithItems(items);
            appendItemsToList(items);
        };
        reader.readAsText(file);
    }
}

function appendItemsToList(items) {
    const contextMenu = document.getElementById('special-context-menu');
    const index = contextMenu.currentIndex;

    let list;
    switch(index) {
        case 0:
            list = list1;
            break;
        case 1:
            list = list2;
            break;
        case 2:
            list = list3;
            break;
        case 3:
            list = list4;
            break;
        case 4:
            list = list5;
            break;
        default:
            return; // Invalid index
    }

    // Append new items to the list without clearing it
    Object.keys(items).forEach(uuid => {
        const item = items[uuid];
        if (!list.some(existingItem => existingItem.folderName === item.folderName)) {
            list.push({ folderName: item.folderName, niceName: item.niceName });
        }
    });

    // Save the updated list to local storage
    saveListsToLocalStorage();
}


function updateGridWithItems(items) {
    const gridContainer = document.getElementById('grid-container');
    gridContainer.innerHTML = ''; // Clear existing items

    Object.keys(items).forEach(uuid => {
        const item = items[uuid];
        createGridItem(item.folderName, item.niceName);
    });
}

function updateListWithItems(items) {
    const contextMenu = document.getElementById('special-context-menu');
    const index = contextMenu.currentIndex;

    let list;
    switch(index) {
        case 0:
            list = list1;
            break;
        case 1:
            list = list2;
            break;
        case 2:
            list = list3;
            break;
        case 3:
            list = list4;
            break;
        case 4:
            list = list5;
            break;
        default:
            return; // Invalid index
    }

    // Clear the list
    list.length = 0;

    // Add new items to the list
    Object.keys(items).forEach(uuid => {
        const item = items[uuid];
        list.push({ folderName: item.folderName, niceName: item.niceName });
    });

    // Save the updated list to local storage
    saveListsToLocalStorage();
}


function extractUUIDs(content) {
    const uuidPattern = /\b[A-Fa-f0-9]{8}-[A-Fa-f0-9]{8}-[A-Fa-f0-9]{8}-[A-Fa-f0-9]{8}\b/g;
    const matches = content.match(uuidPattern);
    return matches || [];
}

async function fetchItemDetails(uuids) {
    const url = 'categories/All_Items.xml';
    try {
        const response = await fetch(url);
        if (!response.ok) {
            throw new Error(`HTTP error! Status: ${response.status}`);
        }
        const text = await response.text();
        const lines = text.trim().split('\n');
        const items = {};

        lines.forEach(line => {
            const parts = line.split('|');
            if (parts.length >= 9) {
                const uuid = parts[0].trim();
                if (uuids.includes(uuid)) {
                    items[uuid] = {
                        folderName: parts[0].trim(),
                        niceName: parts[3].trim()
                    };
                }
            }
        });

        return items;
    } catch (error) {
        console.error('Error fetching or processing the XML file:', error);
    }
}

</script>

</body>

</html>
